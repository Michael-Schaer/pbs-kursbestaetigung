<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kurs Renderer</title>
<style>label { display: block; }</style>
</head>
<body>
<h1>Kurs Renderer: Demo</h1>
<ul>
  <li><a href="/kurs/renderer/demo/pdf/al-kurs/de">AL-Kurs</a></li>
  <li><a href="/kurs/renderer/demo/pdf/aufbaukurs/de">Aufbaukurs</a></li>
  <li><a href="/kurs/renderer/demo/pdf/basiskurs/de">Basiskurs</a></li>
  <li><a href="/kurs/renderer/demo/pdf/coachkurs/de">Coachkurs</a></li>
  <li><a href="/kurs/renderer/demo/pdf/futurakurs/de">Futurakurs</a></li>
  <li><a href="/kurs/renderer/demo/pdf/leitpfadikurs/de">Leitpfadikurs</a></li>
  <li><a href="/kurs/renderer/demo/pdf/panoramakurs/de">Panoramakurs</a></li>
  <li><a href="/kurs/renderer/demo/pdf/spektrumkurs/de">Spektrumkurs</a></li>
  <li><a href="/kurs/renderer/demo/pdf/topkurs/de">Topkurs</a></li>
</ul>

<form id="form">
    <label for="name">Name</label><input type="text" id="name" name="name" value="Rengel">
    <label for="vorname">Vorname</label><input type="text" id="vorname" name="vorname" value="Heinrich">
    <label for="wohnort">Wohnort</label><input type="text" id="wohnort" name="wohnort" value="Oberdorf">
    <label for="dauer">Kursdauer</label><input type="text" id="dauer" name="dauer" value="28.09.2017 - 29.09.2017">
    <label for="kursOrt">Kursort</label><input type="text" id="kursOrt" name="kursOrt" value="Solothurn">
    <label for="organisator">Organisator</label><input type="text" id="organisator" name="organisator" value="Pfadibewegung Schweiz (PBS)">
    <label for="geburtstag">Geburtstag</label><input type="text" id="geburtstag" name="geburtstag" value="09.08.1977">
    <label for="anrede">Anrede</label><input type="text" id="anrede" name="anrede" value="Herr">
    <div><button>Absenden</button></div>
</form>

<script>
    function submit() {
        var formData = new FormData(document.querySelector('#form'));
        var object = {};
        formData.forEach(function (value, key) {
            object[key] = value;
        });
        var json = JSON.stringify(object);
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/kurs/renderer/pdf/basiskurs/de', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.responseType = 'blob';
        xhr.onload = function (event) {
            var blob = xhr.response;
            var contentDispo = xhr.getResponseHeader('Content-Disposition');
            // https://stackoverflow.com/a/23054920/
            var fileName = contentDispo.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/)[1];
            saveBlob(blob, fileName);
        };
        xhr.send(json);
    }

    function saveBlob(blob, fileName) {
        var a = document.createElement('a');
        a.href = window.URL.createObjectURL(blob);
        a.download = fileName;
        a.dispatchEvent(new MouseEvent('click'));
    }

    var element = document.querySelector('#form');
    element.addEventListener('submit', function (event) {
        event.preventDefault();
        submit();
    });
</script>

</body>
</html>